<html>

<body>
  <canvas id="canvas" width="256" height="240" style="height: 90vh"></canvas>
  <script type="module">
    import init, { WindowContext } from "./pkg/nes_wasm.js";
    try {
      await init();
      const res = await fetch("../assets/ignore/Super_mario_brothers.nes");
      const buf = await res.arrayBuffer();
      const ctx = new WindowContext("canvas", new Uint8Array(buf));
      window.addEventListener('keydown', (event) => {
        switch (event.key) {
          case "w":
            ctx.keydown_A();
            return;
          case "q":
            ctx.keydown_B();
            return;
          case "e":
            ctx.keydown_SELECT();
            return;
          case "r":
            ctx.keydown_START();
            return;
          case "l":
            ctx.keydown_RIGHT();
            return;
          case "j":
            ctx.keydown_LEFT();
            return;
          case "k":
            ctx.keydown_DOWN();
            return;
          case "i":
            ctx.keydown_UP();
            return;
        }
      });
      window.addEventListener('keyup', (event) => {
        switch (event.key) {
          case "w":
            ctx.keyup_A();
            return;
          case "q":
            ctx.keyup_B();
            return;
          case "e":
            ctx.keyup_SELECT();
            return;
          case "r":
            ctx.keyup_START();
            return;
          case "l":
            ctx.keyup_RIGHT();
            return;
          case "j":
            ctx.keyup_LEFT();
            return;
          case "k":
            ctx.keyup_DOWN();
            return;
          case "i":
            ctx.keyup_UP();
            return;
        }
      });
    } catch { }
  </script>
</body>

</html>